# GraphRAG 项目 3 个月改进规划

## 📋 执行摘要

基于当前项目实现（KGP + 向量检索增强）和12种主流GraphRAG方法的优缺点分析，制定分阶段、可执行的3个月改进计划。目标是将系统从"可用"提升到"优秀"，在保持工程实用性的同时，逐步引入先进技术。

---

## 🎯 总体目标

| 维度 | 当前状态 | 3个月目标 | 提升幅度 |
|------|---------|----------|---------|
| **检索准确率** | ~75% | >85% | +13% |
| **响应时间** | 2-5秒 | <2秒 | -60% |
| **构图速度** | 慢（全量） | 快（增量优化） | +50% |
| **多跳推理** | 基础 | 增强 | 显著提升 |
| **可观测性** | 无 | 完善 | 从0到1 |
| **证据追溯** | 部分 | 100% | 全覆盖 |

---

## 📅 三个月详细规划

### 第一阶段：基础优化与评估体系（第1个月）

**核心目标**：建立质量基线，优化现有实现，为后续改进提供数据支撑

#### Week 1-2：评估体系构建

**任务清单**：
- [ ] 构建黄金评估数据集（50-100个查询案例）
  - 覆盖3个核心专题（控烟、食品安全、环保等）
  - 包含5种分析功能（volume、attitude、trends、keywords、geography）
  - 难度分级：easy(30%)、medium(50%)、hard(20%)
  
- [ ] 开发自动化评估框架
  ```python
  backend/src/utils/rag/eval/
  ├── evaluator.py          # 主评估器
  ├── metrics.py           # 指标计算（Context Precision、Answer Relevancy、Faithfulness、Retrieval Recall）
  ├── dataset_loader.py    # 数据集加载
  └── report_generator.py  # 报告生成
  ```

- [ ] 建立性能监控基线
  - 响应时间分布
  - 检索召回率/准确率
  - Token消耗统计
  - 错误率追踪

**交付物**：
- ✅ 评估数据集（`backend/data/evaluation/golden_dataset.json`）
- ✅ 评估脚本（可自动运行）
- ✅ 首份性能基准报告

**参考方法**：借鉴 **Fast-GraphRAG** 的工程化评估思路

---

#### Week 3-4：现有系统优化

**任务清单**：

1. **构图速度优化**（参考 Fast-GraphRAG）
   - [ ] 优化实体关系提取的批处理逻辑
   - [ ] 实现更智能的增量更新机制
   - [ ] 向量生成并行化优化（当前是串行）
   - [ ] 添加缓存机制（复用已有向量）

2. **检索精度提升**（参考 LightRAG 的轻量化思路）
   - [ ] 优化实体去重算法（当前按文档去重，可改进为全局去重）
   - [ ] 改进关系提取的准确性（两阶段提取的prompt优化）
   - [ ] 增强时间过滤的准确性

3. **代码质量提升**
   - [ ] 重构 `AdvancedRAGSearcher` 类，提高可维护性
   - [ ] 统一错误处理和日志格式
   - [ ] 添加单元测试（覆盖率>60%）

**交付物**：
- ✅ 优化后的向量化流程（速度提升30%+）
- ✅ 改进的检索逻辑（准确率提升5%+）
- ✅ 代码重构文档

**技术选型**：
- 保持现有 KGP 架构（LLM驱动构图）
- 优化工程实现，不引入新方法

---

### 第二阶段：检索能力增强（第2个月）

**核心目标**：引入先进检索技术，显著提升检索效果

#### Week 5-6：重排序与混合检索

**任务清单**：

1. **重排序模型集成**（参考 G-Retriever 的检索器思路）
   - [ ] 集成 BGE-Reranker-Large 模型
   - [ ] 实现重排序接口（`backend/src/utils/rag/reranker/`）
   - [ ] 在 GraphRAG 检索后应用重排序
   - [ ] 性能优化（批量重排序、缓存）

2. **混合检索实现**（参考 MGraphRAG 的多策略思路）
   - [ ] 实现 BM25 关键词检索
   - [ ] 实现 Reciprocal Rank Fusion (RRF) 融合算法
   - [ ] 向量检索 + BM25 + 图检索的三路融合
   - [ ] 动态权重调整（根据查询类型）

3. **元数据增强过滤**
   - [ ] 扩展元数据字段（渠道、情感、影响力、时间等）
   - [ ] 实现多维度过滤接口
   - [ ] 在检索流程中集成元数据过滤

**交付物**：
- ✅ 重排序模块（准确率提升10%+）
- ✅ 混合检索系统（召回率提升15%+）
- ✅ 元数据过滤功能

**预期效果**：
- Context Precision: 75% → 85%
- Retrieval Recall: 70% → 85%

---

#### Week 7-8：多跳推理与图增强

**任务清单**：

1. **多跳推理实现**（参考 GraphRAG 的社区图思路）
   - [ ] 实现2-3跳关系路径查找
   - [ ] 基于核心实体的多跳扩展算法
   - [ ] 路径评分机制（距离、关系强度）
   - [ ] 在检索结果中包含多跳路径

2. **图结构优化**（参考 HippoRAG 的 PageRank 思路）
   - [ ] 实现实体重要性评分（基于度中心性、关系数量）
   - [ ] 在检索时优先考虑重要实体
   - [ ] 构建实体影响力图谱

3. **关系质量提升**
   - [ ] 关系类型分类（因果关系、时间关系、空间关系等）
   - [ ] 关系强度量化（基于共现频率、语义相似度）
   - [ ] 过滤低质量关系

**交付物**：
- ✅ 多跳推理模块（支持2-3跳查询）
- ✅ 实体重要性评分系统
- ✅ 关系质量评估机制

**预期效果**：
- 复杂查询（hard难度）准确率：60% → 75%
- 多跳推理成功率：0% → 70%

---

### 第三阶段：高级特性与生产化（第3个月）

**核心目标**：引入前沿技术，完善生产环境能力

#### Week 9-10：动态图与自适应检索

**任务清单**：

1. **动态图构建**（参考 DALK 的动态自适应思路）
   - [ ] 实现查询时动态扩展图结构
   - [ ] 基于查询意图的图子集选择
   - [ ] 自适应检索策略（根据查询复杂度选择策略）

2. **任务导向优化**（参考 ToG 的任务适配思路）
   - [ ] 为不同分析功能定制检索策略
     - `volume`：侧重时间序列和渠道分布
     - `attitude`：侧重情感实体和观点关系
     - `trends`：侧重事件演变路径
   - [ ] 实现任务特定的Prompt模板
   - [ ] 任务性能评估和优化

3. **嵌入模型升级评估**
   - [ ] 评估 BGE-M3、jina-embeddings-v3 等模型
   - [ ] A/B测试对比效果
   - [ ] 选择最优模型并迁移

**交付物**：
- ✅ 动态图检索系统
- ✅ 任务导向检索策略
- ✅ 嵌入模型升级方案

**预期效果**：
- 任务特定查询准确率：80% → 90%
- 响应时间：2秒 → 1.5秒（通过动态优化）

---

#### Week 11-12：生产化与监控

**任务清单**：

1. **可观测性系统**（参考 GFM-RAG 的监控思路）
   - [ ] 实现RAG性能监控面板
   - [ ] 实时指标收集（响应时间、准确率、错误率）
   - [ ] 告警机制（性能下降、错误率上升）
   - [ ] 可视化Dashboard

2. **证据追溯系统**
   - [ ] 强制所有输出包含证据链
   - [ ] 证据质量评分
   - [ ] 证据可视化展示
   - [ ] 报告自动引用生成

3. **系统稳定性**
   - [ ] 错误恢复机制
   - [ ] 降级策略（Reranker失败时跳过）
   - [ ] 负载均衡和限流
   - [ ] 数据一致性保证

4. **文档与培训**
   - [ ] 完整的技术文档
   - [ ] API使用指南
   - [ ] 最佳实践手册
   - [ ] 团队培训材料

**交付物**：
- ✅ 监控系统（Dashboard + 告警）
- ✅ 证据追溯系统（100%覆盖）
- ✅ 生产环境部署方案
- ✅ 完整文档

**预期效果**：
- 系统可用性：95% → 99.5%
- 证据追溯率：60% → 100%

---

## 🔧 技术选型建议

### 保持现有架构
- ✅ **KGP构图方式**：LLM驱动，灵活且效果好
- ✅ **向量检索增强**：保持向量+图的双重检索
- ✅ **LanceDB存储**：性能好，无需更换

### 引入新技术
| 技术 | 来源方法 | 优先级 | 预期收益 |
|------|---------|--------|---------|
| **重排序模型** | G-Retriever | 高 | 准确率+10% |
| **混合检索** | MGraphRAG | 高 | 召回率+15% |
| **多跳推理** | GraphRAG | 中 | 复杂查询+15% |
| **PageRank评分** | HippoRAG | 中 | 实体重要性+10% |
| **动态图** | DALK | 低 | 灵活性+20% |
| **任务适配** | ToG | 中 | 任务准确率+10% |

### 暂不考虑
- ❌ **GNN模型**（HippoRAG2）：训练成本高，收益不明显
- ❌ **RAPTOR树结构**：不适合关系查询
- ❌ **GFM预训练模型**：依赖大规模数据，成本高

---

## 📊 关键指标追踪

### 技术指标
- **检索准确率**：Context Precision > 85%
- **检索召回率**：Retrieval Recall > 85%
- **响应时间**：P95 < 2秒
- **构图速度**：增量更新 < 10分钟/1000文档
- **多跳推理成功率**：> 70%

### 业务指标
- **证据追溯率**：100%
- **用户满意度**：> 4.0/5.0
- **系统可用性**：> 99.5%
- **误判减少率**：> 20%

---

## 🚀 实施建议

### 优先级排序
1. **P0（必须）**：评估体系、重排序、混合检索、证据追溯
2. **P1（重要）**：多跳推理、元数据过滤、监控系统
3. **P2（可选）**：动态图、任务适配、嵌入模型升级

### 风险控制
- **分阶段上线**：每个阶段完成后进行A/B测试
- **性能监控**：实时监控，及时发现问题
- **回滚方案**：每个新功能都有回滚机制
- **文档同步**：代码和文档同步更新

### 资源需求
- **算法工程师**：1-2人（重点投入检索优化）
- **后端工程师**：1人（系统集成和监控）
- **标注人员**：1人（构建评估数据集）
- **GPU资源**：用于重排序模型推理

---

## 📈 预期成果

### 技术成果
- ✅ 检索准确率提升13%+
- ✅ 响应时间降低60%+
- ✅ 支持多跳推理
- ✅ 完善的监控体系
- ✅ 100%证据追溯

### 业务成果
- ✅ 分析可靠性提升30%+
- ✅ 人工筛选工作量降低40%+
- ✅ 高风险舆情漏报率<10%
- ✅ 用户满意度>4.0/5.0

---

## 📝 每周检查点

### Week 1-2 检查
- [ ] 评估数据集是否完成（≥50个案例）
- [ ] 评估脚本是否可运行
- [ ] 首份基准报告是否生成

### Week 3-4 检查
- [ ] 构图速度是否提升30%+
- [ ] 检索准确率是否提升5%+
- [ ] 代码重构是否完成

### Week 5-6 检查
- [ ] 重排序模块是否集成
- [ ] 混合检索是否实现
- [ ] 准确率是否提升10%+

### Week 7-8 检查
- [ ] 多跳推理是否实现
- [ ] 实体重要性评分是否完成
- [ ] 复杂查询准确率是否提升

### Week 9-10 检查
- [ ] 动态图是否实现
- [ ] 任务适配是否完成
- [ ] 嵌入模型是否评估

### Week 11-12 检查
- [ ] 监控系统是否上线
- [ ] 证据追溯是否100%
- [ ] 文档是否完整

---

## 🎓 学习资源

### 参考论文
- GraphRAG: Unlocking LLM discovery on narrative private data
- LightRAG: A Lightweight Retrieval-Augmented Generation Framework
- HippoRAG: Neurobiologically Inspired Architecture for Knowledge Graph Embedding

### 开源项目
- [BGE-Reranker](https://github.com/FlagOpen/FlagEmbedding)
- [LanceDB](https://github.com/lancedb/lancedb)
- [BM25](https://github.com/dorianbrown/rank_bm25)

---

## 📞 联系方式

如有问题或建议，请联系项目维护团队。

---

**最后更新**: 2025-01-12
**版本**: v1.0

