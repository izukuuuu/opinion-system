# TRS 数据合并模块调用说明

## 模块概览
`backend/src/merge/data_merge.py` 提供两个主要接口：

- `merge_trs_data(topic: str, date: str, logger=None) -> bool`
- `run_merge(topic: str, date: str, logger=None) -> bool`

模块用于整合指定专题和日期下采集到的 TRS Excel 数据，将配置中保留的渠道分别合并、去重并写入 `merge` 目录（JSONL 格式）。

## 调用步骤
1. **准备目录**：
   - 原始 Excel 文件需位于 `backend/data/projects/<topic>/raw/<date>/`（即 `bucket("raw", topic, date)`）目录中。
   - 输出会写入 `backend/data/projects/<topic>/merge/<date>/`（即 `ensure_bucket("merge", topic, date)`) 目录，并按渠道命名为 `*.jsonl`。
2. **渠道配置**：
   - `settings.get_channel_config()` 必须返回包含 `keep`（需要合并的渠道列表）和可选 `field_aliases`（字段别名映射）的配置。
3. **调用函数**：
   - 直接调用 `merge_trs_data(topic, date, logger)` 可在现有日志器下执行合并逻辑。
   - 调用 `run_merge(topic, date, logger)` 会在缺省情况下创建模块日志器、记录模块开始与结果，并内部调用 `merge_trs_data`。
4. **返回值**：
   - 两个接口均返回布尔值，表示是否成功处理并输出至少一个渠道数据。

## 日志说明
模块使用 `log_module_start`、`log_success`、`log_error` 等工具函数记录运行状态。提供 `logger` 可接入自定义日志体系；不提供时 `run_merge` 会通过 `setup_logger` 自动创建。

## 错误处理
- 当原始目录不存在、渠道配置缺失或未找到 Excel 文件时会立即返回 `False` 并记录错误。
- 处理过程中若单个文件或渠道合并失败不会中断其他渠道的处理，错误会写入日志。
