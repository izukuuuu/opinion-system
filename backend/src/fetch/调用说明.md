# 数据提取模块调用说明

## 模块概览
- `fetch_range`：按照专题、时间范围提取数据库中的各渠道数据，并负责生成渠道汇总与合并文件。
- `table_exists`：辅助函数，用于在查询前判断指定专题下的渠道表是否存在。
- `run_fetch`：提供给外部调用的统一入口，负责初始化日志并调度 `fetch_range`。

## 使用步骤
1. **准备配置**  
   - 在 `settings` 中配置 `databases.db_url` 以及 `channels.keep`、`channels.merge_for_analysis` 等信息。
   - 确保 `ensure_bucket("fetch", topic, folder_name)` 指向的目录可写。
2. **调用接口**  
   ```python
   from backend.src.fetch import run_fetch

   ok = run_fetch(topic="demo_topic", start="2024-01-01", end="2024-01-31")
   if not ok:
       raise RuntimeError("数据提取失败")
   ```
3. **结果查看**  
   - 成功时会在 `backend/data/projects/<topic>/fetch/<start>_<end>/` 生成每个渠道的 `*.jsonl`、配置中定义的合并 JSONL，以及 `总体.jsonl`。
   - 日志文件位于 `setup_logger(topic, start)` 定义的输出位置，可查看详细的提取与合并信息。

## 依赖项
- `pandas`：用于数据表处理与拼接。
- `sqlalchemy`：用于构建数据库连接并执行 SQL 查询。
- 项目内部工具：
  - `ensure_bucket`：创建/确认输出目录。
  - `settings`：读取渠道与数据库配置。
  - `write_jsonl`：统一的 JSONL 写入封装。
  - 日志工具：`setup_logger`、`log_module_start`、`log_success`、`log_error`、`log_skip`。
